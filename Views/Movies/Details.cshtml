@model Fall2025_Project3_snkyemba.ViewModels.MovieDetailsViewModel
@{
    ViewData["Title"] = "Movie Details";
}

<h2>@Model.Movie.Title</h2>

<div class="mb-3">
    <strong>Genre:</strong> @Model.Movie.Genre
</div>
<div class="mb-3">
    <strong>Year:</strong> @Model.Movie.Year
</div>
<div class="mb-3">
    <strong>IMDB:</strong> <a href="@Model.Movie.IMDBLink" target="_blank">Link</a>
</div>

@if (Model.Movie.Poster != null && Model.Movie.Poster.Length > 0)
{
    <div class="mb-3">
        <img src="@(String.Format("data:image/jpeg;base64,{0}", Convert.ToBase64String(Model.Movie.Poster)))"
             alt="@Model.Movie.Title" class="img-thumbnail" style="max-width: 300px;" />
    </div>
}
else
{
    <div class="mb-3">
        <em>No poster available</em>
    </div>
}

<h3>Actors</h3>
@if (Model.Movie.ActorMovies != null && Model.Movie.ActorMovies.Any())
{
    <ul>
        @foreach (var am in Model.Movie.ActorMovies)
        {
            <li>
                <a asp-controller="Actors" asp-action="Details" asp-route-id="@am.Actor.Id">
                    @am.Actor.Name
                </a>
            </li>
        }
    </ul>
}
else
{
    <p>No actors listed for this movie.</p>
}

<h3>Average Sentiment About @Model.Movie.Title</h3>
<p>
    @{
        var avgLabel = Model.AverageSentiment >= 0.05 ? "Positive" :
        Model.AverageSentiment <= -0.05 ? "Negative" : "Neutral";
        var avgClass = Model.AverageSentiment >= 0.05 ? "text-success" :
        Model.AverageSentiment <= -0.05 ? "text-danger" : "text-warning";
    }
    <strong class="@avgClass">@avgLabel (@Model.AverageSentiment.ToString("F3"))</strong>
</p>

<h3>Reviews and Sentiment Analysis</h3>
@if (Model.Reviews != null && Model.Reviews.Count > 0)
{
    <table class="table table-striped">
        <thead>
            <tr>
                <th>Review</th>
                <th>Sentiment Analysis</th>
            </tr>
        </thead>
        <tbody>
            @for (int i = 0; i < Model.Reviews.Count; i++)
            {
                var sentiment = Model.ReviewSentiments[i];
                var compound = sentiment.Compound;
                var label = compound >= 0.05 ? "Positive" :
                compound <= -0.05 ? "Negative" : "Neutral";
                var cssClass = compound >= 0.05 ? "text-success" :
                compound <= -0.05 ? "text-danger" : "text-warning";

                <tr>
                    <td>@Model.Reviews[i]</td>
                    <td>
                        <strong class="@cssClass">@label (@compound.ToString("F3"))</strong>
                        <br />
                        <small class="text-muted">
                            Positive: @sentiment.Positive.ToString("F2") |
                            Negative: @sentiment.Negative.ToString("F2") |
                            Neutral: @sentiment.Neutral.ToString("F2")
                        </small>
                    </td>
                </tr>
            }
        </tbody>
    </table>
}
else
{
    <p>No reviews available</p>
}

<div class="mt-3">
    <a asp-action="Edit" asp-route-id="@Model.Movie.Id" class="btn btn-primary">Edit</a>
    <a asp-action="Index" class="btn btn-secondary">Back to List</a>
</div>